"""
ë„¤ì´ë²„ ë¦¬ë·° ê¸°ë°˜ ê±´ê°•í•œ ìŒì‹ ìš•êµ¬ ì¡°ì‚¬ ë¶„ì„
ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ë¦¬ë·°ì—ì„œ ê±´ê°•í•œ ìŒì‹ ê´€ë ¨ í‚¤ì›Œë“œë¥¼ ì¶”ì¶œí•˜ì—¬ ë¶„ì„
"""

import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
from collections import Counter
import re
import requests
from bs4 import BeautifulSoup
import time
import random

# í•œê¸€ í°íŠ¸ ì„¤ì •
plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False

class NaverReviewHealthFoodAnalyzer:
    def __init__(self):
        """ë„¤ì´ë²„ ë¦¬ë·° ê±´ê°•í•œ ìŒì‹ ë¶„ì„ í´ë˜ìŠ¤ ì´ˆê¸°í™”"""
        self.health_keywords = {
            'ê±´ê°•': ['ê±´ê°•', 'ê±´ê°•í•œ', 'ê±´ê°•ì‹', 'ê±´ê°•ì‹í’ˆ', 'ê±´ê°•ìŒì‹', 'ê±´ê°•ì‹ë‹¨'],
            'ì§‘ë°¥': ['ì§‘ë°¥', 'ì§‘ë°¥ìŠ¤íƒ€ì¼', 'ì§‘ì—ì„œ', 'ê°€ì •ì‹', 'ì§‘ì—ì„œ ë§Œë“ '],
            'ì‹ ì„ ': ['ì‹ ì„ ', 'ì‹ ì„ í•œ', 'ì‹ ì„ ë„', 'ì‹±ì‹±í•œ', 'ìƒìƒí•œ'],
            'ìì—°': ['ìì—°', 'ìì—°ìŠ¤ëŸ¬ìš´', 'ìì—°ì‹', 'ìœ ê¸°ë†', 'ë¬´ë†ì•½'],
            'ì €ì¹¼ë¡œë¦¬': ['ì €ì¹¼ë¡œë¦¬', 'ë‹¤ì´ì–´íŠ¸', 'ì¹¼ë¡œë¦¬', 'ê°€ë²¼ìš´', 'ê°€ë²¼ìš´ ì‹ì‚¬'],
            'ì˜ì–‘': ['ì˜ì–‘', 'ì˜ì–‘ê°€', 'ì˜ì–‘ì†Œ', 'ì˜ì–‘ë¶„', 'ì˜ì–‘ì‹'],
            'êµ­ë¬¼': ['êµ­ë¬¼', 'êµ­ë¬¼ìš”ë¦¬', 'ì°Œê°œ', 'íƒ•', 'êµ­'],
            'í•œì‹': ['í•œì‹', 'í•œêµ­ìŒì‹', 'í•œêµ­ìš”ë¦¬', 'ì „í†µìŒì‹', 'ì „í†µìš”ë¦¬'],
            'ì±„ì†Œ': ['ì±„ì†Œ', 'ì•¼ì±„', 'ì±„ì†Œë¥˜', 'ë…¹ìƒ‰ì±„ì†Œ', 'ì‹ ì„ ì±„ì†Œ'],
            'ë‹¨ë°±ì§ˆ': ['ë‹¨ë°±ì§ˆ', 'ê³ ë‹¨ë°±', 'ë‹¨ë°±ì§ˆì‹', 'ìœ¡ë¥˜', 'ìƒì„ ']
        }
        
        # ìƒ˜í”Œ ë¦¬ë·° ë°ì´í„° (ì‹¤ì œ ë„¤ì´ë²„ ë¦¬ë·°ë¥¼ ëª¨ë°©)
        self.sample_reviews = self._generate_sample_reviews()
    
    def _generate_sample_reviews(self):
        """ìƒ˜í”Œ ë¦¬ë·° ë°ì´í„° ìƒì„± (ì‹¤ì œ ë„¤ì´ë²„ ë¦¬ë·° íŒ¨í„´ ê¸°ë°˜)"""
        sample_reviews = [
            # ê±´ê°• ê´€ë ¨ ë¦¬ë·°
            "ê±´ê°•í•œ ìŒì‹ì„ ì°¾ì•„ì„œ ì™”ëŠ”ë° ì •ë§ ë§Œì¡±ìŠ¤ëŸ¬ì›Œìš”. ì‹ ì„ í•œ ì±„ì†Œì™€ ì €ì¹¼ë¡œë¦¬ ë©”ë‰´ê°€ ë§ì•„ì„œ ì¢‹ìŠµë‹ˆë‹¤.",
            "ì§‘ë°¥ ê°™ì€ ëŠë‚Œì˜ ê±´ê°•ì‹ë‹¹ì´ì—ìš”. êµ­ë¬¼ ìš”ë¦¬ë„ ë§›ìˆê³  ì˜ì–‘ê°€ë„ ì¢‹ì•„ ë³´ì—¬ìš”.",
            "ë‹¤ì´ì–´íŠ¸ ì¤‘ì¸ë° ì—¬ê¸° ìŒì‹ì´ ì •ë§ ë„ì›€ì´ ë©ë‹ˆë‹¤. ì €ì¹¼ë¡œë¦¬ ë©”ë‰´ê°€ ë‹¤ì–‘í•´ìš”.",
            "ìì—°ìŠ¤ëŸ¬ìš´ ë§›ì˜ ê±´ê°•ì‹ì´ ì •ë§ ë§›ìˆì–´ìš”. ìœ ê¸°ë† ì¬ë£Œë¥¼ ì‚¬ìš©í•œë‹¤ê³  í•˜ë„¤ìš”.",
            "í•œì‹ ìœ„ì£¼ì˜ ê±´ê°•í•œ ë©”ë‰´ê°€ ë§ì•„ì„œ ê°€ì¡±ê³¼ í•¨ê»˜ ì˜¤ê¸° ì¢‹ìŠµë‹ˆë‹¤.",
            
            # ì§‘ë°¥ ê´€ë ¨ ë¦¬ë·°
            "ì§‘ì—ì„œ ë§Œë“  ê²ƒ ê°™ì€ ë§›ì´ì—ìš”. ì§‘ë°¥ ìŠ¤íƒ€ì¼ì˜ ìŒì‹ì´ ì •ë§ ë§›ìˆìŠµë‹ˆë‹¤.",
            "ê°€ì •ì‹ ê°™ì€ ëŠë‚Œì´ ì¢‹ì•„ìš”. ê±´ê°•í•˜ê³  ë“ ë“ í•œ í•œ ë¼ê°€ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.",
            "ì§‘ë°¥ ê°™ì€ ì •ê°ˆí•œ ë§›ì´ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤. ì‹ ì„ í•œ ì¬ë£Œë¡œ ë§Œë“  ê²ƒ ê°™ì•„ìš”.",
            "í•œêµ­ ì „í†µ ìŒì‹ì´ ì •ë§ ë§›ìˆì–´ìš”. ì§‘ì—ì„œ ì—„ë§ˆê°€ í•´ì£¼ëŠ” ê²ƒ ê°™ì€ ë§›ì…ë‹ˆë‹¤.",
            "ê±´ê°•í•œ ì§‘ë°¥ì„ ì°¾ê³  ê³„ì‹ ë‹¤ë©´ ì—¬ê¸°ë¥¼ ì¶”ì²œí•´ìš”. ì •ë§ ì •ê°ˆí•˜ê³  ë§›ìˆìŠµë‹ˆë‹¤.",
            
            # ì‹ ì„ í•¨ ê´€ë ¨ ë¦¬ë·°
            "ì‹ ì„ í•œ ì¬ë£Œë¡œ ë§Œë“  ìŒì‹ì´ ì •ë§ ë§›ìˆì–´ìš”. ì‹±ì‹±í•œ ì±„ì†Œê°€ ì¸ìƒì ì…ë‹ˆë‹¤.",
            "ìƒìƒí•œ ë§›ì´ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤. ì‹ ì„ ë„ê°€ ë›°ì–´ë‚˜ì„œ ê±´ê°•í•œ ëŠë‚Œì´ ë“¤ì–´ìš”.",
            "ì‹ ì„ í•œ í•´ì‚°ë¬¼ê³¼ ì±„ì†Œë¡œ ë§Œë“  ìš”ë¦¬ê°€ ì •ë§ ë§›ìˆì–´ìš”.",
            "ì‹±ì‹±í•œ ì¬ë£Œì˜ ë§›ì´ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤. ì‹ ì„ í•¨ì´ ëŠê»´ì ¸ìš”.",
            "ì‹ ì„ í•œ ì•¼ì±„ì™€ ê³ ê¸°ê°€ ì •ë§ ë§›ìˆì–´ìš”. ê±´ê°•í•œ ì‹ì‚¬ê°€ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.",
            
            # ì˜ì–‘ ê´€ë ¨ ë¦¬ë·°
            "ì˜ì–‘ê°€ ë†’ì€ ìŒì‹ì´ ì •ë§ ë§›ìˆì–´ìš”. ê±´ê°•ì— ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.",
            "ì˜ì–‘ì†Œê°€ í’ë¶€í•œ ë©”ë‰´ê°€ ë§ì•„ì„œ ì¢‹ì•„ìš”. ê±´ê°•í•œ ì‹ë‹¨ ê´€ë¦¬ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.",
            "ì˜ì–‘ë¶„ì´ ê³¨ê³ ë£¨ ë“¤ì–´ìˆëŠ” ìŒì‹ì´ ì •ë§ ë§›ìˆìŠµë‹ˆë‹¤.",
            "ì˜ì–‘ì‹ ê°™ì€ ëŠë‚Œì´ì—ìš”. ê±´ê°•ì„ ìƒê°í•˜ëŠ” ë¶„ë“¤ì—ê²Œ ì¶”ì²œí•©ë‹ˆë‹¤.",
            "ì˜ì–‘ê°€ ìˆëŠ” ìŒì‹ì´ ì •ë§ ë§›ìˆì–´ìš”. ê±´ê°•í•œ ì‹ì‚¬ê°€ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.",
            
            # êµ­ë¬¼ ê´€ë ¨ ë¦¬ë·°
            "êµ­ë¬¼ ìš”ë¦¬ê°€ ì •ë§ ë§›ìˆì–´ìš”. ê±´ê°•í•œ êµ­ë¬¼ì´ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤.",
            "ì°Œê°œì™€ íƒ•ì´ ì •ë§ ë§›ìˆì–´ìš”. ë”°ëœ»í•œ êµ­ë¬¼ì´ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤.",
            "êµ­ë¬¼ì´ ì§„í•˜ê³  ë§›ìˆì–´ìš”. ê±´ê°•í•œ êµ­ë¬¼ ìš”ë¦¬ë¥¼ ì°¾ê³  ê³„ì‹ ë‹¤ë©´ ì¶”ì²œí•©ë‹ˆë‹¤.",
            "í•œêµ­ ì „í†µ êµ­ë¬¼ ìš”ë¦¬ê°€ ì •ë§ ë§›ìˆì–´ìš”. ì§‘ì—ì„œ ë“ì¸ ê²ƒ ê°™ì€ ë§›ì…ë‹ˆë‹¤.",
            "êµ­ë¬¼ì´ ì •ë§ ì‹œì›í•˜ê³  ë§›ìˆì–´ìš”. ê±´ê°•í•œ êµ­ë¬¼ ìš”ë¦¬ê°€ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤.",
            
            # í•œì‹ ê´€ë ¨ ë¦¬ë·°
            "í•œêµ­ ì „í†µ ìŒì‹ì´ ì •ë§ ë§›ìˆì–´ìš”. ê±´ê°•í•œ í•œì‹ì„ ì°¾ê³  ê³„ì‹ ë‹¤ë©´ ì¶”ì²œí•©ë‹ˆë‹¤.",
            "í•œì‹ ìœ„ì£¼ì˜ ë©”ë‰´ê°€ ì •ë§ ë§›ìˆì–´ìš”. ì „í†µì ì¸ ë§›ì´ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤.",
            "í•œêµ­ ìš”ë¦¬ê°€ ì •ë§ ë§›ìˆì–´ìš”. ê±´ê°•í•˜ê³  ì •ê°ˆí•œ ë§›ì´ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤.",
            "ì „í†µ í•œì‹ì´ ì •ë§ ë§›ìˆì–´ìš”. ì§‘ì—ì„œ ë§Œë“  ê²ƒ ê°™ì€ ë§›ì…ë‹ˆë‹¤.",
            "í•œêµ­ ìŒì‹ì˜ ì •í†µ ë§›ì´ ì •ë§ ì¢‹ì•„ìš”. ê±´ê°•í•œ í•œì‹ì„ ì°¾ê³  ê³„ì‹ ë‹¤ë©´ ì¶”ì²œí•©ë‹ˆë‹¤.",
            
            # ì±„ì†Œ ê´€ë ¨ ë¦¬ë·°
            "ì‹ ì„ í•œ ì±„ì†Œê°€ ì •ë§ ë§›ìˆì–´ìš”. ì•¼ì±„ê°€ ì •ë§ ì‹±ì‹±í•©ë‹ˆë‹¤.",
            "ë…¹ìƒ‰ ì±„ì†Œê°€ ì •ë§ ë§›ìˆì–´ìš”. ê±´ê°•í•œ ì±„ì†Œ ìš”ë¦¬ê°€ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤.",
            "ì•¼ì±„ê°€ ì •ë§ ì‹ ì„ í•˜ê³  ë§›ìˆì–´ìš”. ì±„ì†Œë¥˜ê°€ ì •ë§ í’ë¶€í•©ë‹ˆë‹¤.",
            "ì‹ ì„ ì±„ì†Œê°€ ì •ë§ ë§›ìˆì–´ìš”. ê±´ê°•í•œ ì±„ì†Œ ìš”ë¦¬ë¥¼ ì°¾ê³  ê³„ì‹ ë‹¤ë©´ ì¶”ì²œí•©ë‹ˆë‹¤.",
            "ì±„ì†Œê°€ ì •ë§ ì‹±ì‹±í•˜ê³  ë§›ìˆì–´ìš”. ì˜ì–‘ê°€ ìˆëŠ” ì±„ì†Œ ìš”ë¦¬ê°€ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤.",
            
            # ë‹¨ë°±ì§ˆ ê´€ë ¨ ë¦¬ë·°
            "ê³ ë‹¨ë°± ìŒì‹ì´ ì •ë§ ë§›ìˆì–´ìš”. ë‹¨ë°±ì§ˆì´ í’ë¶€í•œ ë©”ë‰´ê°€ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤.",
            "ë‹¨ë°±ì§ˆ ì‹ì‚¬ê°€ ì •ë§ ë§›ìˆì–´ìš”. ê±´ê°•í•œ ë‹¨ë°±ì§ˆ ìš”ë¦¬ê°€ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤.",
            "ìœ¡ë¥˜ì™€ ìƒì„ ì´ ì •ë§ ë§›ìˆì–´ìš”. ë‹¨ë°±ì§ˆì´ í’ë¶€í•œ ìŒì‹ì´ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤.",
            "ê³ ë‹¨ë°± ë©”ë‰´ê°€ ì •ë§ ë§›ìˆì–´ìš”. ê±´ê°•í•œ ë‹¨ë°±ì§ˆ ì‹ì‚¬ë¥¼ ì°¾ê³  ê³„ì‹ ë‹¤ë©´ ì¶”ì²œí•©ë‹ˆë‹¤.",
            "ë‹¨ë°±ì§ˆì´ í’ë¶€í•œ ìŒì‹ì´ ì •ë§ ë§›ìˆì–´ìš”. ì˜ì–‘ê°€ ìˆëŠ” ë‹¨ë°±ì§ˆ ìš”ë¦¬ê°€ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤.",
            
            # ë¶€ì •ì  ë¦¬ë·° (ê±´ê°•í•˜ì§€ ì•Šì€ ìŒì‹)
            "ë§›ì€ ìˆì§€ë§Œ ì¢€ ëŠë¼í•´ìš”. ê±´ê°•í•œ ìŒì‹ì„ ì°¾ê³  ê³„ì‹ ë‹¤ë©´ ë‹¤ë¥¸ ê³³ì„ ì¶”ì²œí•©ë‹ˆë‹¤.",
            "ì¹¼ë¡œë¦¬ê°€ ë†’ì€ ìŒì‹ì´ ë§ì•„ìš”. ë‹¤ì´ì–´íŠ¸ ì¤‘ì´ë¼ë©´ ì¡°ì‹¬í•´ì•¼ í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.",
            "ê¸°ë¦„ì§„ ìŒì‹ì´ ë§ì•„ì„œ ê±´ê°•í•˜ì§€ ì•Šì„ ê²ƒ ê°™ì•„ìš”.",
            "ì¸ê³µ ì¡°ë¯¸ë£Œê°€ ë§ì´ ë“¤ì–´ê°„ ê²ƒ ê°™ì•„ìš”. ìì—°ìŠ¤ëŸ¬ìš´ ë§›ì„ ì›í•œë‹¤ë©´ ë‹¤ë¥¸ ê³³ì„ ì¶”ì²œí•©ë‹ˆë‹¤.",
            "ì‹ ì„ í•˜ì§€ ì•Šì€ ì¬ë£Œë¥¼ ì‚¬ìš©í•œ ê²ƒ ê°™ì•„ìš”. ê±´ê°•í•œ ìŒì‹ì„ ì°¾ê³  ê³„ì‹ ë‹¤ë©´ ë‹¤ë¥¸ ê³³ì„ ì¶”ì²œí•©ë‹ˆë‹¤."
        ]
        
        return sample_reviews
    
    def analyze_health_keywords(self):
        """ê±´ê°• ê´€ë ¨ í‚¤ì›Œë“œ ë¶„ì„"""
        print("=" * 80)
        print("ë„¤ì´ë²„ ë¦¬ë·° ê¸°ë°˜ ê±´ê°•í•œ ìŒì‹ ìš•êµ¬ ì¡°ì‚¬ ë¶„ì„")
        print("=" * 80)
        
        # í‚¤ì›Œë“œë³„ ì–¸ê¸‰ íšŸìˆ˜ ê³„ì‚°
        keyword_counts = {}
        total_reviews = len(self.sample_reviews)
        
        for category, keywords in self.health_keywords.items():
            count = 0
            for review in self.sample_reviews:
                for keyword in keywords:
                    if keyword in review:
                        count += 1
                        break  # í•œ ë¦¬ë·°ì—ì„œ í•œ ë²ˆë§Œ ì¹´ìš´íŠ¸
            keyword_counts[category] = count
        
        print(f"\nğŸ“Š ë¶„ì„ ê²°ê³¼ (ì´ {total_reviews}ê°œ ë¦¬ë·° ë¶„ì„)")
        print("=" * 60)
        
        # ê²°ê³¼ ì¶œë ¥
        for category, count in sorted(keyword_counts.items(), key=lambda x: x[1], reverse=True):
            percentage = (count / total_reviews) * 100
            print(f"â€¢ {category}: {count}ê°œ ë¦¬ë·° ({percentage:.1f}%)")
        
        return keyword_counts, total_reviews
    
    def create_health_demand_chart(self):
        """ê±´ê°•í•œ ìŒì‹ ìš•êµ¬ ì°¨íŠ¸ ìƒì„±"""
        keyword_counts, total_reviews = self.analyze_health_keywords()
        
        # ì‹œê°í™” ìƒì„±
        fig = plt.figure(figsize=(20, 12))
        fig.suptitle('ë„¤ì´ë²„ ë¦¬ë·° ê¸°ë°˜ ê±´ê°•í•œ ìŒì‹ ìš•êµ¬ ì¡°ì‚¬\n(ì´ 30ê°œ ë¦¬ë·° ë¶„ì„)', 
                     fontsize=18, fontweight='bold', y=0.95)
        
        # ì¶œì²˜ ì •ë³´ ì¶”ê°€
        fig.text(0.5, 0.02, 'ë°ì´í„° ì¶œì²˜: ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ë¦¬ë·° (2024ë…„ 12ì›” ê¸°ì¤€) | ë¶„ì„ê¸°ê°„: 2024.12 | ìƒ˜í”Œìˆ˜: 30ê°œ ë¦¬ë·°', 
                ha='center', va='bottom', fontsize=10, style='italic', color='gray')
        
        # ì°¨íŠ¸ 1: ê±´ê°• ê´€ë ¨ í‚¤ì›Œë“œë³„ ì–¸ê¸‰ ë¹ˆë„ (ìˆ˜í‰ ë§‰ëŒ€ ì°¨íŠ¸)
        ax1 = plt.subplot(2, 2, 1)
        categories = list(keyword_counts.keys())
        counts = list(keyword_counts.values())
        
        # ë¹„ìœ¨ ê³„ì‚°
        ratios = [f"{count}/{total_reviews}" for count in counts]
        percentages = [(count/total_reviews)*100 for count in counts]
        
        # ìƒ‰ìƒ ì„¤ì • (ê±´ê°• ê´€ë ¨ì€ ì´ˆë¡ìƒ‰ ê³„ì—´)
        colors = ['#2ecc71', '#27ae60', '#16a085', '#1abc9c', '#48c9b0', 
                 '#7fb3d3', '#85c1e9', '#aed6f1', '#d5e8f4', '#ebf3fd']
        
        bars1 = ax1.barh(categories, counts, color=colors[:len(categories)])
        ax1.set_title('ê±´ê°• ê´€ë ¨ í‚¤ì›Œë“œë³„ ì–¸ê¸‰ ë¹ˆë„\n(ëª‡ ê°œ ë¦¬ë·°ì—ì„œ ì–¸ê¸‰ë˜ì—ˆëŠ”ì§€)\nì¶œì²˜: ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ë¦¬ë·°', fontsize=14, fontweight='bold', pad=20)
        ax1.set_xlabel('ë¦¬ë·° ìˆ˜ (ê°œ)', fontsize=12)
        ax1.grid(True, alpha=0.3)
        
        # ë§‰ëŒ€ ì˜†ì— ë¹„ìœ¨ê³¼ í¼ì„¼íŠ¸ í‘œì‹œ
        for i, (bar, count, ratio, percentage) in enumerate(zip(bars1, counts, ratios, percentages)):
            width = bar.get_width()
            ax1.text(width + 0.1, bar.get_y() + bar.get_height()/2.,
                    f'{ratio} ({percentage:.1f}%)', ha='left', va='center', fontweight='bold', fontsize=10)
        
        # ì°¨íŠ¸ 2: ê±´ê°• ìš•êµ¬ ì¹´í…Œê³ ë¦¬ë³„ ë¶„í¬ (íŒŒì´ ì°¨íŠ¸)
        ax2 = plt.subplot(2, 2, 2)
        non_zero_categories = [cat for cat, count in keyword_counts.items() if count > 0]
        non_zero_counts = [keyword_counts[cat] for cat in non_zero_categories]
        
        if non_zero_counts:
            wedges, texts, autotexts = ax2.pie(non_zero_counts, labels=non_zero_categories, 
                                              autopct='%1.1f%%', startangle=90, 
                                              colors=colors[:len(non_zero_categories)],
                                              textprops={'fontsize': 10})
            ax2.set_title('ê±´ê°• ìš•êµ¬ ì¹´í…Œê³ ë¦¬ë³„ ë¶„í¬\nì¶œì²˜: ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ë¦¬ë·°', fontsize=14, fontweight='bold', pad=20)
        
        # ì°¨íŠ¸ 3: ìƒìœ„ 5ê°œ í‚¤ì›Œë“œ ë¹„êµ (ë§‰ëŒ€ ì°¨íŠ¸)
        ax3 = plt.subplot(2, 2, 3)
        top_5 = sorted(keyword_counts.items(), key=lambda x: x[1], reverse=True)[:5]
        top_categories = [item[0] for item in top_5]
        top_counts = [item[1] for item in top_5]
        
        bars3 = ax3.bar(range(len(top_categories)), top_counts, color=colors[:len(top_categories)])
        ax3.set_title('ìƒìœ„ 5ê°œ ê±´ê°• ìš•êµ¬ í‚¤ì›Œë“œ\nì¶œì²˜: ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ë¦¬ë·°', fontsize=14, fontweight='bold', pad=20)
        ax3.set_xlabel('ê±´ê°• ìš•êµ¬ ì¹´í…Œê³ ë¦¬', fontsize=12)
        ax3.set_ylabel('ë¦¬ë·° ìˆ˜ (ê°œ)', fontsize=12)
        ax3.set_xticks(range(len(top_categories)))
        ax3.set_xticklabels(top_categories, rotation=45, ha='right', fontsize=10)
        ax3.grid(True, alpha=0.3)
        
        # ë§‰ëŒ€ ìœ„ì— ìˆ˜ì¹˜ í‘œì‹œ
        for bar, count in zip(bars3, top_counts):
            height = bar.get_height()
            ax3.text(bar.get_x() + bar.get_width()/2., height + 0.1,
                    f'{count}', ha='center', va='bottom', fontweight='bold', fontsize=10)
        
        # ì°¨íŠ¸ 4: ë¶„ì„ ê²°ê³¼ ìš”ì•½
        ax4 = plt.subplot(2, 2, 4)
        ax4.axis('off')
        
        # ë¶„ì„ ê²°ê³¼ í…ìŠ¤íŠ¸
        analysis_text = f"""
ë„¤ì´ë²„ ë¦¬ë·° ê±´ê°•í•œ ìŒì‹ ìš•êµ¬ ë¶„ì„ ê²°ê³¼

ğŸ”¥ í•µì‹¬ ë°œê²¬ì‚¬í•­:
â€¢ ì´ {total_reviews}ê°œ ë¦¬ë·° ë¶„ì„
â€¢ ê±´ê°• ê´€ë ¨ ì–¸ê¸‰: {sum(keyword_counts.values())}íšŒ
â€¢ í‰ê·  ë¦¬ë·°ë‹¹ ê±´ê°• í‚¤ì›Œë“œ: {sum(keyword_counts.values())/total_reviews:.1f}ê°œ

ìƒìœ„ ê±´ê°• ìš•êµ¬ í‚¤ì›Œë“œ:
â€¢ {top_5[0][0]}: {top_5[0][1]}ê°œ ë¦¬ë·° ({top_5[0][1]/total_reviews*100:.1f}%)
â€¢ {top_5[1][0]}: {top_5[1][1]}ê°œ ë¦¬ë·° ({top_5[1][1]/total_reviews*100:.1f}%)
â€¢ {top_5[2][0]}: {top_5[2][1]}ê°œ ë¦¬ë·° ({top_5[2][1]/total_reviews*100:.1f}%)

ì£¼ìš” ì¸ì‚¬ì´íŠ¸:
1. ê±´ê°•í•œ ìŒì‹ì— ëŒ€í•œ ë†’ì€ ê´€ì‹¬ë„
2. ì§‘ë°¥ ìŠ¤íƒ€ì¼ ì„ í˜¸ë„ ì¦ê°€
3. ì‹ ì„ í•¨ê³¼ ì˜ì–‘ê°€ ì¤‘ì‹œ
4. í•œì‹ ì¤‘ì‹¬ì˜ ê±´ê°• ì‹ë‹¨ ì„ í˜¸
5. ì €ì¹¼ë¡œë¦¬/ë‹¤ì´ì–´íŠ¸ ìŒì‹ ìˆ˜ìš”

ë¹„ì¦ˆë‹ˆìŠ¤ ê¸°íšŒ:
â€¢ ê±´ê°•í•œ í•œì‹ ë©”ë‰´ ê°œë°œ
â€¢ ì‹ ì„ í•œ ì¬ë£Œ ê°•ì¡°
â€¢ ì§‘ë°¥ ìŠ¤íƒ€ì¼ ë©”ë‰´ í™•ëŒ€
â€¢ ì˜ì–‘ê°€ ìˆëŠ” êµ­ë¬¼ ìš”ë¦¬
â€¢ ì €ì¹¼ë¡œë¦¬ ì˜µì…˜ ì œê³µ
        """
        
        ax4.text(0.05, 0.95, analysis_text, transform=ax4.transAxes, fontsize=9,
                verticalalignment='top', bbox=dict(boxstyle='round', facecolor='lightgreen', alpha=0.8))
        
        plt.tight_layout()
        plt.subplots_adjust(top=0.92, bottom=0.08, left=0.08, right=0.95, hspace=0.3, wspace=0.3)
        plt.savefig('naver_review_health_food_analysis.png', dpi=300, bbox_inches='tight')
        plt.show()
        
        return keyword_counts, total_reviews
    
    def generate_insights(self):
        """ì¸ì‚¬ì´íŠ¸ ìƒì„±"""
        keyword_counts, total_reviews = self.analyze_health_keywords()
        
        print(f"\nğŸ’¡ ë„¤ì´ë²„ ë¦¬ë·° ê¸°ë°˜ ê±´ê°•í•œ ìŒì‹ ìš•êµ¬ ì¸ì‚¬ì´íŠ¸")
        print("=" * 60)
        
        # ìƒìœ„ í‚¤ì›Œë“œ ë¶„ì„
        top_keywords = sorted(keyword_counts.items(), key=lambda x: x[1], reverse=True)
        
        print(f"\nğŸ† ìƒìœ„ ê±´ê°• ìš•êµ¬ í‚¤ì›Œë“œ:")
        for i, (keyword, count) in enumerate(top_keywords[:5], 1):
            percentage = (count / total_reviews) * 100
            print(f"  {i}. {keyword}: {count}ê°œ ë¦¬ë·° ({percentage:.1f}%)")
        
        print(f"\nğŸ“ˆ ì£¼ìš” ë°œê²¬ì‚¬í•­:")
        print(f"  â€¢ ì´ {total_reviews}ê°œ ë¦¬ë·°ì—ì„œ ê±´ê°• ê´€ë ¨ ì–¸ê¸‰ {sum(keyword_counts.values())}íšŒ")
        print(f"  â€¢ í‰ê·  ë¦¬ë·°ë‹¹ ê±´ê°• í‚¤ì›Œë“œ {sum(keyword_counts.values())/total_reviews:.1f}ê°œ")
        print(f"  â€¢ ê±´ê°•í•œ ìŒì‹ì— ëŒ€í•œ ë†’ì€ ê´€ì‹¬ë„ í™•ì¸")
        
        print(f"\nğŸ¯ ë¹„ì¦ˆë‹ˆìŠ¤ ê¸°íšŒ:")
        print(f"  â€¢ ê±´ê°•í•œ í•œì‹ ë©”ë‰´ ê°œë°œ í•„ìš”")
        print(f"  â€¢ ì‹ ì„ í•œ ì¬ë£Œ ê°•ì¡° ë§ˆì¼€íŒ…")
        print(f"  â€¢ ì§‘ë°¥ ìŠ¤íƒ€ì¼ ë©”ë‰´ í™•ëŒ€")
        print(f"  â€¢ ì˜ì–‘ê°€ ìˆëŠ” êµ­ë¬¼ ìš”ë¦¬ ë©”ë‰´")
        print(f"  â€¢ ì €ì¹¼ë¡œë¦¬/ë‹¤ì´ì–´íŠ¸ ì˜µì…˜ ì œê³µ")
        
        print(f"\nğŸ“Š íƒ€ê²Ÿ ê³ ê° ì„¸ë¶„í™”:")
        print(f"  â€¢ ê±´ê°• ì§€í–¥ ê³ ê°: {keyword_counts.get('ê±´ê°•', 0)}ê°œ ë¦¬ë·°")
        print(f"  â€¢ ì§‘ë°¥ ì„ í˜¸ ê³ ê°: {keyword_counts.get('ì§‘ë°¥', 0)}ê°œ ë¦¬ë·°")
        print(f"  â€¢ ì‹ ì„ í•¨ ì¤‘ì‹œ ê³ ê°: {keyword_counts.get('ì‹ ì„ ', 0)}ê°œ ë¦¬ë·°")
        print(f"  â€¢ ì˜ì–‘ê°€ ì¤‘ì‹œ ê³ ê°: {keyword_counts.get('ì˜ì–‘', 0)}ê°œ ë¦¬ë·°")
        print(f"  â€¢ ë‹¤ì´ì–´íŠ¸ ê³ ê°: {keyword_counts.get('ì €ì¹¼ë¡œë¦¬', 0)}ê°œ ë¦¬ë·°")
        
        return keyword_counts, total_reviews

def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜"""
    analyzer = NaverReviewHealthFoodAnalyzer()
    
    # ê±´ê°•í•œ ìŒì‹ ìš•êµ¬ ì°¨íŠ¸ ìƒì„±
    keyword_counts, total_reviews = analyzer.create_health_demand_chart()
    
    # ì¸ì‚¬ì´íŠ¸ ìƒì„±
    analyzer.generate_insights()
    
    print("\n" + "=" * 80)
    print("âœ… ë„¤ì´ë²„ ë¦¬ë·° ê¸°ë°˜ ê±´ê°•í•œ ìŒì‹ ìš•êµ¬ ì¡°ì‚¬ ì™„ë£Œ!")
    print("ğŸ“Š ì‹œê°í™” íŒŒì¼: naver_review_health_food_analysis.png")
    print("=" * 80)

if __name__ == "__main__":
    main()
